<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<RULES>
    <RULE APP_VERSION="8.2.2-731" CACHE_TTL="259200" CACHE_TTL_SYNCED="true" CLASSIFICATION="REG_STATUS" DESCRIPTION="" ENABLED="true" ID="1513127954854134337" NAME="PrintNightmare (CVE-2021-1675)" NOT_COND_UPDATE="true" UPGRADE_PERFORMED="true">
        <GROUP_IN_FILTER/>
        <INACTIVITY_TTL TTL="0" USE_DEFAULT="true"/>
        <ADMISSION_RESOLVE_DELAY TTL="0" USE_DEFAULT="true"/>
        <MATCH_TIMING RATE="28800" SKIP_INACTIVE="true">
            <ADMISSION ALL="true"/>
        </MATCH_TIMING>
        <EXPRESSION EXPR_TYPE="OR">
            <!--Rule expression. Rule name is: PrintNightmare (CVE-2021-1675)-->
            <EXPRESSION EXPR_TYPE="SIMPLE">
                <CONDITION EMPTY_LIST_VALUE="false" FIELD_NAME="in-group" LABEL="Member of Group" LEFT_PARENTHESIS="0" LOGIC="OR" RET_VALUE_ON_UKNOWN="IRRESOLVED" RIGHT_PARENTHESIS="0">
                    <FILTER FILTER_ID="-1671142496058292032">
                        <GROUP ID="1361820504861611965" NAME="Domain Managed Windows Devices"/>
                    </FILTER>
                </CONDITION>
            </EXPRESSION>
            <EXPRESSION EXPR_TYPE="SIMPLE">
                <CONDITION EMPTY_LIST_VALUE="false" FIELD_NAME="in-group" LABEL="Member of Group" LEFT_PARENTHESIS="0" LOGIC="OR" RET_VALUE_ON_UKNOWN="IRRESOLVED" RIGHT_PARENTHESIS="0">
                    <FILTER FILTER_ID="-7634829670023577211">
                        <GROUP ID="4971506990523499532" NAME="Secure Connector Managed Windows"/>
                    </FILTER>
                </CONDITION>
            </EXPRESSION>
            <EXPRESSION EXPR_TYPE="SIMPLE">
                <CONDITION EMPTY_LIST_VALUE="false" FIELD_NAME="in-group" LABEL="Member of Group" LEFT_PARENTHESIS="0" LOGIC="AND" RET_VALUE_ON_UKNOWN="IRRESOLVED" RIGHT_PARENTHESIS="0">
                    <FILTER FILTER_ID="667565445340363898">
                        <GROUP ID="7733179734437730121" NAME="P-Windows Domain Manageable"/>
                    </FILTER>
                </CONDITION>
            </EXPRESSION>
        </EXPRESSION>
        <EXCEPTION NAME="ip" UNKNOWN_EVAL="UNMATCH"/>
        <EXCEPTION NAME="mac" UNKNOWN_EVAL="UNMATCH"/>
        <EXCEPTION NAME="nbthost" UNKNOWN_EVAL="UNMATCH"/>
        <EXCEPTION NAME="user" UNKNOWN_EVAL="UNMATCH"/>
        <EXCEPTION NAME="group" UNKNOWN_EVAL="UNMATCH"/>
        <ORIGIN NAME="CUSTOM"/>
        <UNMATCH_TIMING RATE="28800" SKIP_INACTIVE="true">
            <ADMISSION ALL="true"/>
        </UNMATCH_TIMING>
        <SEGMENT ID="1586270014442715117" NAME="Forescout Lab">
            <RANGE FROM="192.168.1.0" TO="192.168.2.255"/>
            <RANGE FROM="192.168.4.0" TO="192.168.4.255"/>
            <RANGE FROM="192.168.20.0" TO="192.168.20.255"/>
        </SEGMENT>
        <RULE_CHAIN>
            <INNER_RULE APP_VERSION="8.2.2-731" CACHE_TTL="259200" CACHE_TTL_SYNCED="true" CLASSIFICATION="REG_STATUS" DESCRIPTION="" ID="-1007075007339053964" NAME="DC and PrintSpooler" NOT_COND_UPDATE="true" RECHECK_MAIN_RULE_DEF="true">
                <MATCH_TIMING RATE="28800" SKIP_INACTIVE="true">
                    <ADMISSION ALL="true"/>
                </MATCH_TIMING>
                <EXPRESSION EXPR_TYPE="AND">
                    <!--Rule expression. Rule name is: DC and PrintSpooler-->
                    <EXPRESSION EXPR_TYPE="SIMPLE">
                        <CONDITION EMPTY_LIST_VALUE="false" FIELD_NAME="prim_classification" LABEL="Function" LEFT_PARENTHESIS="0" LOGIC="AND" PLUGIN_NAME="Device Classification Engine" PLUGIN_UNIQUE_NAME="classification" PLUGIN_VESRION="1.4.2.1038" PLUGIN_VESRION_NUMBER="14021038" RET_VALUE_ON_UKNOWN="IRRESOLVED" RIGHT_PARENTHESIS="0">
                            <FILTER FILTER_ID="-779493122514531690" MATCH_SUBTREE="true">
                                <PATH VALUE="Information Technology/Computer/Server"/>
                            </FILTER>
                        </CONDITION>
                    </EXPRESSION>
                    <EXPRESSION EXPR_TYPE="SIMPLE">
                        <CONDITION EMPTY_LIST_VALUE="false" FIELD_NAME="script_result.7e60665980fa03fd2217536abb62dc0c" LABEL="Windows Expected Script Result Command or Script file:domaincontroller.vbs, Run Interactive:false" LEFT_PARENTHESIS="0" LOGIC="AND" PLUGIN_NAME="HPS Inspection Engine" PLUGIN_UNIQUE_NAME="va" PLUGIN_VESRION="11.1.2" PLUGIN_VESRION_NUMBER="111020046" RET_VALUE_ON_UKNOWN="IRRESOLVED" RIGHT_PARENTHESIS="0">
                            <FIELD METANAME="script_result" NAME="script_result.7e60665980fa03fd2217536abb62dc0c">
                                <PARAM NAME="script_howtorun_prop" TYPE="string" VALUE="domaincontroller.vbs"/>
                                <PARAM NAME="script_interactive" TYPE="string" VALUE="false"/>
                            </FIELD>
                            <FILTER CASE_SENSITIVE="false" FILTER_ID="119112846943295690" TYPE="contains">
                                <VALUE VALUE2="domain controller"/>
                            </FILTER>
                        </CONDITION>
                    </EXPRESSION>
                    <EXPRESSION EXPR_TYPE="SIMPLE">
                        <CONDITION EMPTY_LIST_VALUE="false" FIELD_NAME="service" LABEL="Windows Services Running" LEFT_PARENTHESIS="0" LOGIC="AND" PLUGIN_NAME="HPS Inspection Engine" PLUGIN_UNIQUE_NAME="va" PLUGIN_VESRION="11.1.2" PLUGIN_VESRION_NUMBER="111020046" RET_VALUE_ON_UKNOWN="IRRESOLVED" RIGHT_PARENTHESIS="0">
                            <FILTER CASE_SENSITIVE="false" FILTER_ID="8515919630663664725" TYPE="contains">
                                <VALUE VALUE2="print spooler"/>
                            </FILTER>
                        </CONDITION>
                    </EXPRESSION>
                </EXPRESSION>
                <ACTION DISABLED="true" NAME="sendmail">
                    <PARAM NAME="signature" VALUE="default"/>
                    <PARAM NAME="subject" VALUE="Domain Controller has Print Spooler Running "/>
                    <PARAM NAME="to" VALUE="securityteam@forescout.com"/>
                    <PARAM NAME="message" VALUE="Hello,&#10;&#10;We found a domain controller ({hostname}) running the Print Spooler Service. It is recommended to disable the print spooler service on Domain Controllers for CVE-2021-1675).&#10;&#10;Host Information:&#10;&#10;IP Address: &#9;&#9;{ip}&#10;MAC Address: &#9;&#9;{mac}&#10;Hostname:&#9;&#9;{nbtdomain}/{nbthost}&#10;DNS Name:&#9;&#9;{hostname}&#10;Logged in User: &#9;{user}&#10;&#10;"/>
                    <PARAM NAME="aggregate" VALUE="false"/>
                    <SCHEDULE>
                        <START Class="Immediately"/>
                        <OCCURENCE onStart="true"/>
                    </SCHEDULE>
                </ACTION>
                <ACTION DISABLED="false" NAME="run_script">
                    <PARAM NAME="script_howtorun_ac" VALUE="spooler.vbs"/>
                    <PARAM NAME="script_interactive" VALUE="false"/>
                    <PARAM NAME="define_time_to_run" VALUE="false"/>
                    <PARAM NAME="time_to_run" VALUE="1"/>
                    <SCHEDULE>
                        <START Class="Immediately"/>
                        <OCCURENCE onStart="true"/>
                    </SCHEDULE>
                </ACTION>
            </INNER_RULE>
            <INNER_RULE APP_VERSION="8.2.2-731" CACHE_TTL="259200" CACHE_TTL_SYNCED="true" CLASSIFICATION="REG_STATUS" DESCRIPTION="" ID="662954209661811781" NAME="Print Spooler Running on Servers" NOT_COND_UPDATE="true" RECHECK_MAIN_RULE_DEF="true">
                <MATCH_TIMING RATE="28800" SKIP_INACTIVE="true">
                    <ADMISSION ALL="true"/>
                </MATCH_TIMING>
                <EXPRESSION EXPR_TYPE="AND">
                    <!--Rule expression. Rule name is: Print Spooler Running on Servers-->
                    <EXPRESSION EXPR_TYPE="SIMPLE">
                        <CONDITION EMPTY_LIST_VALUE="false" FIELD_NAME="prim_classification" LABEL="Function" LEFT_PARENTHESIS="0" LOGIC="AND" PLUGIN_NAME="Device Classification Engine" PLUGIN_UNIQUE_NAME="classification" PLUGIN_VESRION="1.4.2.1038" PLUGIN_VESRION_NUMBER="14021038" RET_VALUE_ON_UKNOWN="IRRESOLVED" RIGHT_PARENTHESIS="0">
                            <FILTER FILTER_ID="7766568927541808339" MATCH_SUBTREE="true">
                                <PATH VALUE="Information Technology/Computer/Server"/>
                            </FILTER>
                        </CONDITION>
                    </EXPRESSION>
                    <EXPRESSION EXPR_TYPE="SIMPLE">
                        <CONDITION EMPTY_LIST_VALUE="false" FIELD_NAME="service" LABEL="Windows Services Running" LEFT_PARENTHESIS="0" LOGIC="AND" PLUGIN_NAME="HPS Inspection Engine" PLUGIN_UNIQUE_NAME="va" PLUGIN_VESRION="11.1.2" PLUGIN_VESRION_NUMBER="111020046" RET_VALUE_ON_UKNOWN="IRRESOLVED" RIGHT_PARENTHESIS="0">
                            <FILTER CASE_SENSITIVE="false" FILTER_ID="3950669396581548152" TYPE="contains">
                                <VALUE VALUE2="print spooler"/>
                            </FILTER>
                        </CONDITION>
                    </EXPRESSION>
                </EXPRESSION>
                <ACTION DISABLED="true" NAME="sendmail">
                    <PARAM NAME="signature" VALUE="default"/>
                    <PARAM NAME="subject" VALUE="Server Running the Print Spooler Service"/>
                    <PARAM NAME="to" VALUE="securityteam@forescout.com"/>
                    <PARAM NAME="message" VALUE="Hello,&#10;&#10;We have detected a server ({hostname}) running the Print Spooler Service and it needs to be investigated per CVE-2021-1675.&#10;&#10;Host Information:&#10;&#10;IP Address: &#9;&#9;{ip}&#10;MAC Address: &#9;&#9;{mac}&#10;Hostname:&#9;&#9;{nbtdomain}/{nbthost}&#10;DNS Name:&#9;&#9;{hostname}&#10;Logged in User: &#9;{user}&#10;&#10;"/>
                    <PARAM NAME="aggregate" VALUE="false"/>
                    <SCHEDULE>
                        <START Class="Immediately"/>
                        <OCCURENCE onStart="true"/>
                    </SCHEDULE>
                </ACTION>
                <ACTION DISABLED="false" NAME="run_script">
                    <PARAM NAME="script_howtorun_ac" VALUE="spooler.vbs"/>
                    <PARAM NAME="script_interactive" VALUE="false"/>
                    <PARAM NAME="define_time_to_run" VALUE="false"/>
                    <PARAM NAME="time_to_run" VALUE="1"/>
                    <SCHEDULE>
                        <START Class="Immediately"/>
                        <OCCURENCE onStart="true"/>
                    </SCHEDULE>
                </ACTION>
            </INNER_RULE>
            <INNER_RULE APP_VERSION="8.2.2-731" CACHE_TTL="259200" CACHE_TTL_SYNCED="true" CLASSIFICATION="REG_STATUS" DESCRIPTION="" ID="-7376602466565290924" NAME="Computer and Print Spooler Service Running" NOT_COND_UPDATE="true" RECHECK_MAIN_RULE_DEF="true">
                <MATCH_TIMING RATE="28800" SKIP_INACTIVE="true">
                    <ADMISSION ALL="true"/>
                </MATCH_TIMING>
                <EXPRESSION EXPR_TYPE="AND">
                    <!--Rule expression. Rule name is: Computer and Print Spooler Service Running-->
                    <EXPRESSION EXPR_TYPE="SIMPLE">
                        <CONDITION EMPTY_LIST_VALUE="false" FIELD_NAME="prim_classification" LABEL="Function" LEFT_PARENTHESIS="0" LOGIC="AND" PLUGIN_NAME="Device Classification Engine" PLUGIN_UNIQUE_NAME="classification" PLUGIN_VESRION="1.4.2.1038" PLUGIN_VESRION_NUMBER="14021038" RET_VALUE_ON_UKNOWN="IRRESOLVED" RIGHT_PARENTHESIS="0">
                            <FILTER FILTER_ID="-5890102008093770970" MATCH_SUBTREE="true">
                                <PATH VALUE="Information Technology/Computer"/>
                            </FILTER>
                        </CONDITION>
                    </EXPRESSION>
                    <EXPRESSION EXPR_TYPE="SIMPLE">
                        <CONDITION EMPTY_LIST_VALUE="false" FIELD_NAME="service" LABEL="Windows Services Running" LEFT_PARENTHESIS="0" LOGIC="AND" PLUGIN_NAME="HPS Inspection Engine" PLUGIN_UNIQUE_NAME="va" PLUGIN_VESRION="11.1.2" PLUGIN_VESRION_NUMBER="111020046" RET_VALUE_ON_UKNOWN="IRRESOLVED" RIGHT_PARENTHESIS="0">
                            <FILTER CASE_SENSITIVE="false" FILTER_ID="1464645157200693060" TYPE="contains">
                                <VALUE VALUE2="print spooler"/>
                            </FILTER>
                        </CONDITION>
                    </EXPRESSION>
                </EXPRESSION>
                <ACTION DISABLED="true" NAME="sendmail">
                    <PARAM NAME="signature" VALUE="default"/>
                    <PARAM NAME="subject" VALUE="Print Spooler Running on Computer"/>
                    <PARAM NAME="to" VALUE="securityteam@forescout.com"/>
                    <PARAM NAME="message" VALUE="Hello,&#10;&#10;We have detected the Print Spooler Service running on {hostname} and needs to be investigated per CVE-2021-1675&#10;&#10;Host Information:&#10;&#10;IP Address: &#9;&#9;{ip}&#10;MAC Address: &#9;&#9;{mac}&#10;Hostname:&#9;&#9;{nbtdomain}/{nbthost}&#10;DNS Name:&#9;&#9;{hostname}&#10;Logged in User: &#9;{user}&#10;&#10;"/>
                    <PARAM NAME="aggregate" VALUE="false"/>
                    <SCHEDULE>
                        <START Class="Immediately"/>
                        <OCCURENCE onStart="true"/>
                    </SCHEDULE>
                </ACTION>
                <ACTION DISABLED="false" NAME="run_script">
                    <PARAM NAME="script_howtorun_ac" VALUE="spooler.vbs"/>
                    <PARAM NAME="script_interactive" VALUE="false"/>
                    <PARAM NAME="define_time_to_run" VALUE="false"/>
                    <PARAM NAME="time_to_run" VALUE="1"/>
                    <SCHEDULE>
                        <START Class="Immediately"/>
                        <OCCURENCE onStart="true"/>
                    </SCHEDULE>
                </ACTION>
            </INNER_RULE>
            <INNER_RULE APP_VERSION="8.2.2-731" CACHE_TTL="259200" CACHE_TTL_SYNCED="true" CLASSIFICATION="REG_STATUS" DESCRIPTION="" ID="8142770428215628941" NAME="Print Spooler Not Running" NOT_COND_UPDATE="true" RECHECK_MAIN_RULE_DEF="true">
                <MATCH_TIMING RATE="28800" SKIP_INACTIVE="true">
                    <ADMISSION ALL="true"/>
                </MATCH_TIMING>
                <EXPRESSION EXPR_TYPE="NOT">
                    <!--Rule expression. Rule name is: Print Spooler Not Running-->
                    <EXPRESSION EXPR_TYPE="SIMPLE">
                        <CONDITION EMPTY_LIST_VALUE="false" FIELD_NAME="service" INNER_NOT="true" LABEL="Windows Services Running" LEFT_PARENTHESIS="0" LOGIC="AND" PLUGIN_NAME="HPS Inspection Engine" PLUGIN_UNIQUE_NAME="va" PLUGIN_VESRION="11.1.2" PLUGIN_VESRION_NUMBER="111020046" RET_VALUE_ON_UKNOWN="IRRESOLVED" RIGHT_PARENTHESIS="0">
                            <FILTER CASE_SENSITIVE="false" FILTER_ID="1337181474556999658" TYPE="contains">
                                <VALUE VALUE2="Print Spooler"/>
                            </FILTER>
                        </CONDITION>
                    </EXPRESSION>
                </EXPRESSION>
            </INNER_RULE>
        </RULE_CHAIN>
        <REPORT_TABLES/>
    </RULE>
</RULES>
